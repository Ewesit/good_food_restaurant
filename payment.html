<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good Food Restaurant</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Genos:ital,wght@0,100;0,200;0,300;0,400;0,500;1,100;1,200;1,300;1,400&display=swap" rel="stylesheet">

</head>
<body>
    <!--navbar-->
    <header>
        
            <img class="logo" src="Assets\logo3.png" alt="Logo"> <!--logo-->
            <nav>
                <ul class="nav_links" type="none">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="menu.html">Our Menu</a></li>
                    <li><a href="About.html">About Us</a></li>
                </ul>
            </nav>
            <a class="cta" href="contact.html"><button>Contact US</button></a>
        
    </header>
    <!-- <hr> -->

    <h1>M-Pesa Payment</h1>
    <button onclick="makePayment()">Make Payment</button>

    <script>

        async function makePayment() {
            const consumerKey = 'zngM7dQAAwq5VrcEhcf9M3s4eQUaSpcbG6D5AdgT20KNa88N';
            const consumerSecret = 'u6dsGd2bdDA6YAEdOFgHNIRCwRbzm3tf5tnFGAoYJsGiru5Y6VnIuIJXe6NUhiJ3';

            try {
                // Step 1: Obtain access token
                const authResponse = await fetch('https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Basic ' + btoa(consumerKey + ':' + consumerSecret),
                        'Content-Type': 'application/json'
                    }
                });

                const authData = await authResponse.json();
                const accessToken = authData.access_token;

                // Step 2: Make payment request
                const paymentRequest = {
                    'BusinessShortCode': '174379',
                    'Password': 'Safaricom999!*!', // Replace with your actual password or generate dynamically
                    'Timestamp': '20240208023456', // Replace with actual timestamp
                    'TransactionType': 'CustomerPayBillOnline',
                    'Amount': '1',
                    'PartyA': '254708374149', // Replace with customer's phone number
                    'PartyB': '74379', // Replace with your Paybill number
                    'PhoneNumber': '254708374149', // Replace with customer's phone number
                    'CallBackURL': 'https://sandbox.safaricom.co.ke/mpesa/', // URL for receiving payment notifications
                    'AccountReference': 'Good Food Restaurant', // Replace with your order ID
                    'TransactionDesc': 'Testing STKPUSH' // Description of the transaction
                };


                const paymentResponse = await fetch('https://sandbox.safaricom.co.ke/mpesa/stkpush/v1/processrequest', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(paymentRequest)
                });

                const paymentData = await paymentResponse.json();
                console.log(paymentData); // Log the payment response
            } catch (error) {
                console.error('Error making payment:', error);
                alert('Error making payment. Please try again later.');
            }
        }
    </script>
</body>
</html>
